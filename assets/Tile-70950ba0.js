import{q as nt,E as fe,T as u,j as Ye,s as st,u as rt,v as ot,w as se,x as Oe,y as lt,z as Ie,A as at,B as de,C as X,D as ht,F as Ae,G as be,H as Y,J as Ze,K as ct,L as ut,N as te,O as ie,b as Te,a as Ge,g as _e,P as dt,Q as gt,R as ft,S as Me,U as Tt,e as N,W as _t,X as mt,n as xt,Y as O,Z as Et,_ as Rt,l as pt,$ as ze,a0 as je,a1 as Xe,a2 as ve,a3 as Ct,a4 as yt,a5 as wt,i as Ft,a6 as St}from"./proj4-75e1e0c4.js";import{r as Pt,a as Lt,b as Ot,T as It,E as zt}from"./Image-dc01ef9b.js";class jt extends nt{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(fe.CHANGE)}release(){this.state===u.ERROR&&this.setState(u.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==u.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==u.LOADED){e.interimTile=null;break}e.getState()==u.LOADING?t=e:e.getState()==u.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==u.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){Ye()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:st(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const Ue=jt;class Xt extends Ue{constructor(e,t,i,n,s,r){super(e,t,r),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=u.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=u.ERROR,this.unlistenImage_(),this.image_=vt(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=u.LOADED:this.state=u.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==u.ERROR&&(this.state=u.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==u.IDLE&&(this.state=u.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=rt(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function vt(){const o=ot(1,1);return o.fillStyle="rgba(0,0,0,0)",o.fillRect(0,0,1,1),o.canvas}const Ke=Xt;class Dt extends Ue{constructor(e,t,i,n,s,r,l,h,a,c,d,_){super(s,u.IDLE,_),this.renderEdges_=d!==void 0?d:!1,this.pixelRatio_=l,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=r||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const T=n.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let g=this.sourceTileGrid_.getExtent();const y=f?se(T,f):T;if(Oe(y)===0){this.state=u.EMPTY;return}const x=e.getExtent();x&&(g?g=se(g,x):g=x);const E=n.getResolution(this.wrappedTileCoord_[0]),R=Ot(e,i,y,E);if(!isFinite(R)||R<=0){this.state=u.EMPTY;return}const p=c!==void 0?c:zt;if(this.triangulation_=new It(e,i,y,g,R*p,E),this.triangulation_.getTriangles().length===0){this.state=u.EMPTY;return}this.sourceZ_=t.getZForResolution(R);let C=this.triangulation_.calculateSourceExtent();if(g&&(e.canWrapX()?(C[1]=de(C[1],g[1],g[3]),C[3]=de(C[3],g[1],g[3])):C=se(C,g)),!Oe(C))this.state=u.EMPTY;else{const w=t.getTileRangeForExtentAndZ(C,this.sourceZ_);for(let b=w.minX;b<=w.maxX;b++)for(let I=w.minY;I<=w.maxY;I++){const A=a(this.sourceZ_,b,I,l);A&&this.sourceTiles_.push(A)}this.sourceTiles_.length===0&&(this.state=u.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==u.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=u.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],r=this.targetTileGrid_.getResolution(t),l=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Pt(n,s,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),r,h,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=u.LOADED}this.changed()}load(){if(this.state==u.IDLE){this.state=u.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==u.IDLE||i==u.LOADING){e++;const n=lt(t,fe.CHANGE,function(s){const r=t.getState();(r==u.LOADED||r==u.ERROR||r==u.EMPTY)&&(Ie(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,n){t.getState()==u.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Ie),this.sourcesListenerKeys_=null}release(){this.canvas_&&(at(this.canvas_.getContext("2d")),Lt.push(this.canvas_),this.canvas_=null),super.release()}}const ge=Dt;class Yt{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return X(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return X(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){X(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}const At=Yt;function De(o,e,t,i){return i!==void 0?(i[0]=o,i[1]=e,i[2]=t,i):[o,e,t]}function re(o,e,t){return o+"/"+e+"/"+t}function ke(o){return re(o[0],o[1],o[2])}function bt(o){return o.split("/").map(Number)}function Zt(o){return(o[1]<<o[0])+o[2]}function Gt(o,e){const t=o[0],i=o[1],n=o[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(i,n):!0}class Mt extends At{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=bt(e)[0];this.forEach(n=>{n.tileCoord[0]!==i&&(this.remove(ke(n.tileCoord)),n.release())})}}const qe=Mt,ue={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class Ne{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function k(o,e,t,i,n){return n!==void 0?(n.minX=o,n.maxX=e,n.minY=t,n.maxY=i,n):new Ne(o,e,t,i)}const $e=Ne,q=[0,0,0],D=5;class Ut{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,X(ht(this.resolutions_,(n,s)=>s-n,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,X(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Ae(i)),X(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,X(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:be,X(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,s)=>{const r=new $e(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const l=this.getTileRangeForExtentAndZ(i,s);r.minX=Math.max(l.minX,r.minX),r.maxX=Math.min(l.maxX,r.maxX),r.minY=Math.max(l.minY,r.minY),r.maxY=Math.min(l.maxY,r.maxY)}return r}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let s=n.minX,r=n.maxX;s<=r;++s)for(let l=n.minY,h=n.maxY;l<=h;++l)i([t,s,l])}forEachTileCoordParentTileRange(e,t,i,n){let s,r,l,h=null,a=e[0]-1;for(this.zoomFactor_===2?(r=e[1],l=e[2]):h=this.getTileCoordExtent(e,n);a>=this.minZoom;){if(r!==void 0&&l!==void 0?(r=Math.floor(r/2),l=Math.floor(l/2),s=k(r,r,l,l,i)):s=this.getTileRangeForExtentAndZ(h,a,i),t(a,s))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,r=e[2]*2;return k(s,s+1,r,r+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],s=e[1],r=e[2];if(t===n)return k(s,r,s,r,i);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,t-n),a=Math.floor(s*h),c=Math.floor(r*h);if(t<n)return k(a,a,c,c,i);const d=Math.floor(h*(s+1))-1,_=Math.floor(h*(r+1))-1;return k(a,d,c,_,i)}const l=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,q);const n=q[1],s=q[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,q);const r=q[1],l=q[2];return k(n,r,s,l,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=Y(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=Y(this.getTileSize(e[0]),this.tmpSize_),r=i[0]+e[1]*s[0]*n,l=i[1]-(e[2]+1)*s[1]*n,h=r+s[0]*n,a=l+s[1]*n;return Ze(r,l,h,a,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,s){const r=this.getZForResolution(i),l=i/this.getResolution(r),h=this.getOrigin(r),a=Y(this.getTileSize(r),this.tmpSize_);let c=l*(e-h[0])/i/a[0],d=l*(h[1]-t)/i/a[1];return n?(c=te(c,D)-1,d=te(d,D)-1):(c=ie(c,D),d=ie(d,D)),De(r,c,d,s)}getTileCoordForXYAndZ_(e,t,i,n,s){const r=this.getOrigin(i),l=this.getResolution(i),h=Y(this.getTileSize(i),this.tmpSize_);let a=(e-r[0])/l/h[0],c=(r[1]-t)/l/h[1];return n?(a=te(a,D)-1,c=te(c,D)-1):(a=ie(a,D),c=ie(c,D)),De(i,a,c,s)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=ct(this.resolutions_,e,t||0);return de(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return ut(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}const We=Ut;function He(o){let e=o.getDefaultTileGrid();return e||(e=Nt(o),o.setDefaultTileGrid(e)),e}function Kt(o,e,t){const i=e[0],n=o.getTileCoordCenter(e),s=me(t);if(!Me(s,n)){const r=_e(s),l=Math.ceil((s[0]-n[0])/r);return n[0]+=r*l,o.getTileCoordForCoordAndZ(n,i)}return e}function kt(o,e,t,i){i=i!==void 0?i:"top-left";const n=Be(o,e,t);return new We({extent:o,origin:ft(o,i),resolutions:n,tileSize:t})}function qt(o){const e=o||{},t=e.extent||Te("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Be(t,e.maxZoom,e.tileSize,e.maxResolution)};return new We(i)}function Be(o,e,t,i){e=e!==void 0?e:dt,t=Y(t!==void 0?t:be);const n=Ge(o),s=_e(o);i=i>0?i:Math.max(s/t[0],n/t[1]);const r=e+1,l=new Array(r);for(let h=0;h<r;++h)l[h]=i/Math.pow(2,h);return l}function Nt(o,e,t,i){const n=me(o);return kt(n,e,t,i)}function me(o){o=Te(o);let e=o.getExtent();if(!e){const t=180*gt.degrees/o.getMetersPerUnit();e=Ze(-t,-t,t,t)}return e}class $t extends Tt{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Y(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new qe(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,n){const s=this.getTileCacheForProjection(e);if(!s)return!1;let r=!0,l,h,a;for(let c=i.minX;c<=i.maxX;++c)for(let d=i.minY;d<=i.maxY;++d)h=re(t,c,d),a=!1,s.containsKey(h)&&(l=s.get(h),a=l.getState()===u.LOADED,a&&(a=n(l)!==!1)),a||(r=!1);return r}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,s){return Ye()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:He(e)}getTileCacheForProjection(e){const t=this.getProjection();return X(t===null||N(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(t),r=Y(n.getTileSize(e),this.tmpSize);return s==1?r:_t(r,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=Kt(i,e,t)),Gt(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,n){}}class Wt extends mt{constructor(e,t){super(e),this.tile=t}}const Ht=$t;function Bt(o,e){const t=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(r,l,h){if(r)return o.replace(t,r[0].toString()).replace(i,r[1].toString()).replace(n,r[2].toString()).replace(s,function(){const a=r[0],c=e.getFullTileRange(a);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-r[2]-1).toString()})}}function Vt(o,e){const t=o.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Bt(o[n],e);return Qt(i)}function Qt(o){return o.length===1?o[0]:function(e,t,i){if(!e)return;const n=Zt(e),s=xt(n,o.length);return o[s](e,t,i)}}function Jt(o){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(o);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let s;for(s=i;s<=n;++s)e.push(o.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(o),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(o.replace(t[0],n.toString()));return e}return e.push(o),e}class xe extends Ht{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===xe.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=O(t),n=t.getState();let s;n==u.LOADING?(this.tileLoadingKeys_[i]=!0,s=ue.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==u.ERROR?ue.TILELOADERROR:n==u.LOADED?ue.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Wt(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Jt(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Vt(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const n=re(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const ei=xe;class ti extends ei{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ii,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:Ke,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection){const s=this.tileCacheForProjection[n];s.expireCache(s==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!N(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!N(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||N(t,e)))return this.tileGrid;const i=O(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=He(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||N(t,e))return this.tileCache;const i=O(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new qe(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,n,s,r){const l=[e,t,i],h=this.getTileCoordForTileUrlFunction(l,s),a=h?this.tileUrlFunction(h,n,s):void 0,c=new this.tileClass(l,a!==void 0?u.IDLE:u.EMPTY,a!==void 0?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=r,c.addEventListener(fe.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,i,n,s){const r=this.getProjection();if(!r||!s||N(r,s))return this.getTileInternal(e,t,i,n,r||s);const l=this.getTileCacheForProjection(s),h=[e,t,i];let a;const c=ke(h);l.containsKey(c)&&(a=l.get(c));const d=this.getKey();if(a&&a.key==d)return a;const _=this.getTileGridForProjection(r),T=this.getTileGridForProjection(s),f=this.getTileCoordForTileUrlFunction(h,s),g=new ge(r,_,s,T,h,f,this.getTilePixelRatio(n),this.getGutter(),(y,x,E,R)=>this.getTileInternal(y,x,E,R,r),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return g.key=d,a?(g.interimTile=a,g.refreshInterimChain(),l.replace(c,g)):l.set(c,g),g}getTileInternal(e,t,i,n,s){let r=null;const l=re(e,t,i),h=this.getKey();if(!this.tileCache.containsKey(l))r=this.createTile_(e,t,i,n,s,h),this.tileCache.set(l,r);else if(r=this.tileCache.get(l),r.key!=h){const a=r;r=this.createTile_(e,t,i,n,s,h),a.getState()==u.IDLE?r.interimTile=a.interimTile:r.interimTile=a,r.refreshInterimChain(),this.tileCache.replace(l,r)}return r}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=Te(e);if(i){const n=O(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function ii(o,e){o.getImage().src=e}const ni=ti;class si extends ni{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:qt({extent:me(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const ri=si,oi='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class li extends ri{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[oi];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",n=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:n,wrapX:e.wrapX,zDirection:e.zDirection})}}const Ti=li,ne={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class ai extends Et{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(ne.PRELOAD)}setPreload(e){this.set(ne.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(ne.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(ne.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const hi=ai;class ci extends Rt{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=pt(),this.tmpTileRange_=new $e(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==u.LOADED||i==u.EMPTY||i==u.ERROR&&!n}getTile(e,t,i,n){const s=n.pixelRatio,r=n.viewState.projection,l=this.getLayer();let a=l.getSource().getTile(e,t,i,s,r);return a.getState()==u.ERROR&&l.getUseInterimTilesOnError()&&l.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=ze(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!Me(s,n))return null;const r=t.pixelRatio,l=t.viewState.projection,h=t.viewState,a=i.getRenderSource(),c=a.getTileGridForProjection(h.projection),d=a.getTilePixelRatio(t.pixelRatio);for(let _=c.getZForResolution(h.resolution);_>=c.getMinZoom();--_){const T=c.getTileCoordForCoordAndZ(n,_),f=a.getTile(_,T[1],T[2],r,l);if(!(f instanceof Ke||f instanceof ge)||f instanceof ge&&f.getState()===u.EMPTY)return null;if(f.getState()!==u.LOADED)continue;const g=c.getOrigin(_),y=Y(c.getTileSize(_)),x=c.getResolution(_),E=Math.floor(d*((n[0]-g[0])/x-T[1]*y[0])),R=Math.floor(d*((g[1]-n[1])/x-T[2]*y[1])),p=Math.round(d*a.getGutterForProjection(h.projection));return this.getImageData(f.getImage(),E+p,R+p)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],n=e.viewState,s=n.projection,r=n.resolution,l=n.center,h=n.rotation,a=e.pixelRatio,c=this.getLayer(),d=c.getSource(),_=d.getRevision(),T=d.getTileGridForProjection(s),f=T.getZForResolution(r,d.zDirection),g=T.getResolution(f);let y=e.extent;const x=e.viewState.resolution,E=d.getTilePixelRatio(a),R=Math.round(_e(y)/x*a),p=Math.round(Ge(y)/x*a),C=i.extent&&je(i.extent);C&&(y=se(y,je(i.extent)));const w=g*R/2/E,b=g*p/2/E,I=[l[0]-w,l[1]-b,l[0]+w,l[1]+b],A=T.getTileRangeForExtentAndZ(y,f),$={};$[f]={};const Ee=this.createLoadedTileFinder(d,s,$),Re=this.tmpExtent,pe=this.tmpTileRange_;this.newTiles_=!1;const Ve=h?Xe(n.center,x,h,e.size):void 0;for(let v=A.minX;v<=A.maxX;++v)for(let F=A.minY;F<=A.maxY;++F){if(h&&!T.tileCoordIntersectsViewport([f,v,F],Ve))continue;const S=this.getTile(f,v,F,e);if(this.isDrawableTile(S)){const M=O(this);if(S.getState()==u.LOADED){$[f][S.tileCoord.toString()]=S;let U=S.inTransition(M);U&&i.opacity!==1&&(S.endTransition(M),U=!1),!this.newTiles_&&(U||!this.renderedTiles.includes(S))&&(this.newTiles_=!0)}if(S.getAlpha(M,e.time)===1)continue}const ae=T.getTileCoordChildTileRange(S.tileCoord,pe,Re);let H=!1;ae&&(H=Ee(f+1,ae)),H||T.forEachTileCoordParentTileRange(S.tileCoord,Ee,pe,Re)}const Q=g/r*a/E;ve(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/a,1/a,h,-R/2,-p/2);const oe=Ct(this.pixelTransform);this.useContainer(t,oe,this.getBackground(e));const m=this.context,Z=m.canvas;yt(this.inversePixelTransform,this.pixelTransform),ve(this.tempTransform,R/2,p/2,Q,Q,0,-R/2,-p/2),Z.width!=R||Z.height!=p?(Z.width=R,Z.height=p):this.containerReused||m.clearRect(0,0,R,p),C&&this.clipUnrotated(m,e,C),d.getInterpolate()||(m.imageSmoothingEnabled=!1),this.preRender(m,e),this.renderedTiles.length=0;let W=Object.keys($).map(Number);W.sort(wt);let G,le,L;i.opacity===1&&(!this.containerReused||d.getOpaque(e.viewState.projection))?W=W.reverse():(G=[],le=[]);for(let v=W.length-1;v>=0;--v){const F=W[v],S=d.getTilePixelSize(F,a,s),H=T.getResolution(F)/g,M=S[0]*H*Q,U=S[1]*H*Q,he=T.getTileCoordForCoordAndZ(Ae(I),F),Ce=T.getTileCoordExtent(he),J=ze(this.tempTransform,[E*(Ce[0]-I[0])/g,E*(I[3]-Ce[3])/g]),Qe=E*d.getGutterForProjection(s),ye=$[F];for(const Je in ye){const K=ye[Je],we=K.tileCoord,Fe=he[1]-we[1],et=Math.round(J[0]-(Fe-1)*M),Se=he[2]-we[2],tt=Math.round(J[1]-(Se-1)*U),z=Math.round(J[0]-Fe*M),j=Math.round(J[1]-Se*U),B=et-z,V=tt-j,Pe=f===F,Le=Pe&&K.getAlpha(O(this),e.time)!==1;let ce=!1;if(!Le)if(G){L=[z,j,z+B,j,z+B,j+V,z,j+V];for(let ee=0,it=G.length;ee<it;++ee)if(f!==F&&F<le[ee]){const P=G[ee];Ft([z,j,z+B,j+V],[P[0],P[3],P[4],P[7]])&&(ce||(m.save(),ce=!0),m.beginPath(),m.moveTo(L[0],L[1]),m.lineTo(L[2],L[3]),m.lineTo(L[4],L[5]),m.lineTo(L[6],L[7]),m.moveTo(P[6],P[7]),m.lineTo(P[4],P[5]),m.lineTo(P[2],P[3]),m.lineTo(P[0],P[1]),m.clip())}G.push(L),le.push(F)}else m.clearRect(z,j,B,V);this.drawTileImage(K,e,z,j,B,V,Qe,Pe),G&&!Le?(ce&&m.restore(),this.renderedTiles.unshift(K)):this.renderedTiles.push(K),this.updateUsedTiles(e.usedTiles,d,K)}}return this.renderedRevision=_,this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!St(this.renderedExtent_,I),this.renderedExtent_=I,this.renderedPixelRatio=a,this.renderedProjection=s,this.manageTilePyramid(e,d,T,a,s,y,f,c.getPreload()),this.scheduleExpireCache(e,d),this.postRender(m,e),i.extent&&m.restore(),m.imageSmoothingEnabled=!0,oe!==Z.style.transform&&(Z.style.transform=oe),this.container}drawTileImage(e,t,i,n,s,r,l,h){const a=this.getTileImage(e);if(!a)return;const c=O(this),d=t.layerStatesArray[t.layerIndex],_=d.opacity*(h?e.getAlpha(c,t.time):1),T=_!==this.context.globalAlpha;T&&(this.context.save(),this.context.globalAlpha=_),this.context.drawImage(a,l,l,a.width-2*l,a.height-2*l,i,n,s,r),T&&this.context.restore(),_!==d.opacity?t.animate=!0:h&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=function(n,s,r){const l=O(n);l in r.usedTiles&&n.expireCache(r.viewState.projection,r.usedTiles[l])}.bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const n=O(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}manageTilePyramid(e,t,i,n,s,r,l,h,a){const c=O(t);c in e.wantedTiles||(e.wantedTiles[c]={});const d=e.wantedTiles[c],_=e.tileQueue,T=i.getMinZoom(),f=e.viewState.rotation,g=f?Xe(e.viewState.center,e.viewState.resolution,f,e.size):void 0;let y=0,x,E,R,p,C,w;for(w=T;w<=l;++w)for(E=i.getTileRangeForExtentAndZ(r,w,E),R=i.getResolution(w),p=E.minX;p<=E.maxX;++p)for(C=E.minY;C<=E.maxY;++C)f&&!i.tileCoordIntersectsViewport([w,p,C],g)||(l-w<=h?(++y,x=t.getTile(w,p,C,n,s),x.getState()==u.IDLE&&(d[x.getKey()]=!0,_.isKeyQueued(x.getKey())||_.enqueue([x,c,i.getTileCoordCenter(x.tileCoord),R])),a!==void 0&&a(x)):t.useTile(w,p,C,s));t.updateCacheSize(y,s)}}const ui=ci;class di extends hi{constructor(e){super(e)}createRenderer(){return new ui(this)}}const _i=di;export{Ti as O,_i as T,We as a,ni as b,Qt as c,qt as d,Jt as e,Zt as h};
//# sourceMappingURL=Tile-70950ba0.js.map
